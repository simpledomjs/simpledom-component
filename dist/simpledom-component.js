!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.SimpleDomComponent=n():t.SimpleDomComponent=n()}(window,function(){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){t.exports=e(1)},function(t,n,e){"use strict";function r(t){return!!(t&&t.constructor&&t.call&&t.apply)}function o(t){return t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}function i(t){return Array.isArray(t)?t.reduce(function(t,n){return t.concat(Array.isArray(n)?i(n):n)},[]):t}function c(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function u(t,n,e){if(null!=t){if(t.isComponent){var r=new t.componentClass(function(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},r=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.forEach(function(n){c(t,n,e[n])})}return t}({},t.props),n);return e.push(r),u(r.renderComponent(t.otherRef),n,e)}if(!t.isElem)return t.__asHtml?t:document.createTextNode(""+t);var i=document.createElement(t.name);!function(t,n){for(var e in n.attrs)n.attrs.hasOwnProperty(e)&&void 0!==n.attrs[e]&&function(){var r=n.attrs[e];if("ref"===e)r(t);else if(e.startsWith("on")){var i=e.substring(2).toLowerCase();t.addEventListener(i,function(t){return r(t)})}else if("className"===e&&(e="class"),"style"===(e=o(e))&&"[object Object]"==Object.prototype.toString.call(r))for(var c in r)r.hasOwnProperty(c)&&(t.style[o(c)]=r[c]);else if("class"===e&&"[object Object]"==Object.prototype.toString.call(r))for(var u in r)r.hasOwnProperty(u)&&r[u]&&t.classList.add(o(u));else t.setAttribute(e,r)}()}(i,t);for(var s=t.children.length,a=0;a<s;a++){var f=t.children[a];if(null!=f){var l=u(f,n,e);null!=l&&(l.__asHtml?i.insertAdjacentHTML("beforeend",l.__asHtml):i.appendChild(l))}}return i}}function s(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function a(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}e.r(n);var f=1;var l=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.state=n,this.subscribers={},this.componentsSubscribes=[],this.componentsToUnmount=[]}var n,e,r;return n=t,(e=[{key:"updateState",value:function(t){var n=this.state;this.state=function(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},r=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.forEach(function(n){s(t,n,e[n])})}return t}({},this.state,t);for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];for(var i=1===r.length?r[0]:r,c=r.concat("*"),u=c.length;u--;){var a=c[u];if(this.subscribers[a])for(var f in this.subscribers[a])this.subscribers[a].hasOwnProperty(f)&&this.subscribers[a][f]("*"===a?i:a,this.state,n)}}},{key:"subscribe",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){},e=arguments.length>2?arguments[2]:void 0;this.subscribers[t]||(this.subscribers[t]={});var r=f++;if(this.subscribers[t][r]=n,e){var o=void 0,i=!0,c=!1,u=void 0;try{for(var s,a=this.componentsSubscribes[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var l=s.value;if(l.component===e){o=l;break}}}catch(t){c=!0,u=t}finally{try{i||null==a.return||a.return()}finally{if(c)throw u}}o||(o={component:e,subscribes:[]},this.componentsSubscribes.push(o)),o.subscribes.push({event:t,id:r})}return r}},{key:"unsubsribe",value:function(t){for(var n=Object.keys(this.subscribers),e=0;e<n.length;e++){var r=n[e];this.subscribers[r][t]&&delete this.subscribers[r][t]}}},{key:"unsubscribeAll",value:function(){this.subscribers={},this.componentsSubscribes=[],this.componentsToUnmount.forEach(function(t){return t.componentDidUnmount()}),this.componentsToUnmount=[]}},{key:"unsubscribeByEventAndId",value:function(t,n){this.subscribers[t][n]&&delete this.subscribers[t][n]}}])&&a(n.prototype,e),r&&a(n,r),t}();function b(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function m(t,n){for(var e=arguments.length,o=new Array(e>2?e-2:0),c=2;c<e;c++)o[c-2]=arguments[c];return t&&t.isComponent?{isComponent:!0,componentClass:t,props:function(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},r=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.forEach(function(n){h(t,n,e[n])})}return t}({},n,{children:(i(o)||[]).filter(function(t){return null!=t})})}:r(t)?t.apply(void 0,[n].concat(o)):{name:t,attrs:n||{},children:(i(o)||[]).filter(function(t){return null!=t}),isElem:!0}}function d(t,n){y(t,[n],arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l)}function y(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l,r=function(t){var n=t;for("string"==typeof t&&(n=document.getElementById(t));n.firstChild;)n.removeChild(n.firstChild);return n}(t),o=[];i(n).filter(function(t){return null!=t}).map(function(t){return u(t,e,o)}).forEach(function(t){return r.appendChild(t)}),o.forEach(function(t){return t.componentDidMount()}),o.length&&(e.refreshComponentsToObserve=function(){document.body.contains(r)||(e.mutationObserver&&e.mutationObserver.disconnect(),e.unsubscribeAll());for(var t=e.componentsToUnmount.length-1;t>=0;t--){var n=e.componentsToUnmount[t];n.node&&!r.contains(n.node)&&(n.componentDidUnmount(),e.componentsToUnmount.splice(t,1))}for(var o=e.componentsSubscribes.length-1;o>=0;o--){var i=e.componentsSubscribes[o];i.component.node&&!r.contains(i.component.node)&&(i.subscribes.forEach(function(t){var n=t.event,r=t.id;return e.unsubscribeByEventAndId(n,r)}),i.component.node=void 0,e.componentsSubscribes.splice(o,1))}},e.mutationObserver=new MutationObserver(function(){return e.refreshComponentsToObserve&&e.refreshComponentsToObserve()}),e.mutationObserver.observe(document.body,{childList:!0,subtree:!0}))}function v(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return i(n).map(function(t){if(!t.name)return""+(t.__asHtml||t);var n=Object.keys(t.attrs).filter(function(n){return!n.startsWith("on")&&void 0!==t.attrs[n]&&"ref"!==n}).map(function(n){var e=o("className"===n?"class":n),r=t.attrs[n];return"style"===e&&"object"===p(r)?r=Object.keys(r).map(function(t){return o(t)+":"+r[t]}).join(";"):"class"===e&&"object"===p(r)&&(r=Object.keys(r).filter(function(t){return r[t]}).map(o).join(" "))," ".concat(e,'="').concat(r,'"')}).join(""),e=v.apply(void 0,b(t.children));return"<".concat(t.name).concat(n,">").concat(e,"</").concat(t.name,">")}).join("")}function O(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];y(t,e)}function g(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function j(t,n,e){return n&&g(t.prototype,n),e&&g(t,e),t}var w,S,C,T=function(){function t(n){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.props=n,this.store=r,Object.getOwnPropertyNames(Object.getPrototypeOf(this)).filter(function(t){return"constructor"!==t}).filter(function(t){return e[t]instanceof Function}).forEach(function(t){return e[t]=e[t].bind(e)});var o=!0,i=!1,c=void 0;try{for(var u,s=this.eventsToSubscribe()[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var a=u.value;this.store.subscribe(a,this.reactToChangeState.bind(this),this)}}catch(t){i=!0,c=t}finally{try{o||null==s.return||s.return()}finally{if(i)throw c}}var f=!0,l=!1,b=void 0;try{for(var p,h=this.eventsToReact()[Symbol.iterator]();!(f=(p=h.next()).done);f=!0){var m=p.value;this.store.subscribe(m,this.react.bind(this),this)}}catch(t){l=!0,b=t}finally{try{f||null==h.return||h.return()}finally{if(l)throw b}}this.componentDidUnmount&&this.store.componentsToUnmount.push(this)}return j(t,[{key:"state",get:function(){return this.store.state}}]),j(t,[{key:"nodeRefHandler",value:function(t){this.node=t,this.otherRef&&this.otherRef(t)}},{key:"refresh",value:function(){var t=[],n=this.node;n||console.warn("It's you've done double refresh on same component, please don't do this",new Error),this.node=null;var e=u(this.renderComponent(),this.store,t);if(null==e)return n&&n.parentNode&&n.parentNode.removeChild(n),void this.componentDidMount();n&&n.parentNode&&n.parentNode.replaceChild(e,n),this.store.refreshComponentsToObserve&&this.store.refreshComponentsToObserve(),this.componentDidMount(),t.forEach(function(t){return t.componentDidMount()})}},{key:"reactToChangeState",value:function(t,n,e){this.mustRefresh(e,n)&&this.node&&(this.componentDidUnmount&&this.componentDidUnmount(),this.refresh(),this.componentDidMount())}},{key:"eventsToSubscribe",value:function(){return[]}},{key:"eventsToReact",value:function(){return[]}},{key:"react",value:function(t){}},{key:"mustRefresh",value:function(t,n){return!0}},{key:"componentDidMount",value:function(){}},{key:"renderComponent",value:function(t){var n=this,e=this.render();if(this.otherRef=t,null==e)return m("div",{ref:function(t){return n.nodeRefHandler(t)},style:{width:0,height:0}});if(e.isElem){var r=e.attrs.ref;e.attrs.ref=function(t){r&&r(t),n.nodeRefHandler(t)}}else e.isComponent?e.otherRef=function(t){return n.nodeRefHandler(t)}:console.error("Unkown result type for a component",e);return e}},{key:"render",value:function(){}}]),t}();function P(t,n,e){return(r(t)?t():t)?r(n)?n():n:r(e)?e():e}C=!0,(S="isComponent")in(w=T)?Object.defineProperty(w,S,{value:C,enumerable:!0,configurable:!0,writable:!0}):w[S]=C,e.d(n,"predicate",function(){return P}),e.d(n,"Component",function(){return T}),e.d(n,"Store",function(){return l}),e.d(n,"el",function(){return m}),e.d(n,"renderToDom",function(){return d}),e.d(n,"renderTo",function(){return O}),e.d(n,"renderToString",function(){return v})}])});
//# sourceMappingURL=simpledom-component.js.map